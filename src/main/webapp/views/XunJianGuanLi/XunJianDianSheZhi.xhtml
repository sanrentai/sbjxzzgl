<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:h="http://xmlns.jcp.org/jsf/html">
    <p:outputPanel id="rootContainer" styleClass="Container100 NoIndent">
        <p:outputPanel styleClass="Card">
            <!--标题-->
            <h1 class="CardBigTopic Purple">
                <h:outputText value="#{ctrlMaster.createPageTitle('XunJianGuanLi', 'XunJianDianSheZhi')}"/>
            </h1>
            <!--无敌分割线-->
            <div class="SeparatorFull"></div>
            <p:outputPanel styleClass="Container100 Responsive100">
                <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank" >
                    <p:outputLabel for="Equipment" value="所属设备："></p:outputLabel>
                    <p:inputText label="所属设备："  
                                 title="所属设备："
                                 readonly="true" 
                                 required="true" 
                                 disabled="#{not empty XunJianDianSheZhiController.vm.currentEquipment}"
                                 value="#{XunJianDianSheZhiController.vm.currentEquipment.ENmae}"></p:inputText>
                    <p:commandButton id="Equipment" 
                                     value="选择设备" 
                                     type="button" 
                                     onclick="PF('deviceSelectDialog').show();"
                                     update="rootContainer">

                    </p:commandButton>
                    <p:commandButton value="选择图片"
                                     disabled="#{empty XunJianDianSheZhiController.vm.currentEquipment}"
                                     type="button"
                                     onclick="PF('pictureSelectDialog').show();">

                    </p:commandButton>
                </p:panelGrid>
            </p:outputPanel>
            <p:outputPanel styleClass="Container100 Responsive100">
                <script>
                    $(document).ready(function () {
                        $(".image").bind("click", function (e) {
                            console.log(e);
                            $(".x").val(e.offsetX);
                            $(".y").val(e.offsetY);
                        });
                    });
                </script>
                <p:outputPanel rendered="#{not empty XunJianDianSheZhiController.vm.currentGraphic}" style="padding-top:0;">
                    <p:outputPanel style="float:left;">
                        <ui:repeat value="#{XunJianDianSheZhiController.vm.currentGraphic.checkPointList}" var="point">
                            <p:graphicImage value="#{XunJianDianSheZhiController.vm.hotPointImagePath}" style="position:relative;left:#{point.x}px;top:#{point.y}px;"></p:graphicImage>
                        </ui:repeat>
                    </p:outputPanel>
                    <p:graphicImage class="image" style="margin-top:0;"
                                    value="#{XunJianDianSheZhiController.vm.currentGraphic.originalFilePath}"
                                    onclick="PF('coordConfirmDialog').show();">
                    </p:graphicImage>
                </p:outputPanel>
            </p:outputPanel>
        </p:outputPanel>
        <p:dialog widgetVar="deviceSelectDialog" modal="true">
            <p:dataTable value="#{XunJianDianSheZhiController.vm.equipmentList}" style="width:512px;"
                         var="equipment" 
                         paginatorAlwaysVisible="false"
                         paginator="true" rows="10"
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                         id="equipmentSelectList" widgetVar="equipmentSelectList"
                         styleClass="bg-c-row-odd wd-f-700"
                         scrollable="true"
                         emptyMessage="无数据">
                <f:facet name="header">
                    <h:outputText value="选择设备"/>
                </f:facet>
                <p:columnGroup type="header">
                    <p:row>
                        <p:column styleClass="tct wd-p-30" headerText="设备名"
                                  filterBy="#{equipment.ENmae}" filterMaxLength="10" filterMatchMode="contains"/>
                        <p:column styleClass="tct wd-p-10" headerText="选择"></p:column>
                        <p:column styleClass="tct wd-p-30" headerText="上级设备"></p:column>
                        <p:column styleClass="tct wd-p-30" headerText="规格/型号"></p:column>
                    </p:row>
                </p:columnGroup>
                <p:column >
                    <h:outputText value="#{equipment.ENmae}">

                    </h:outputText>
                </p:column>
                <p:column>
                    <p:commandLink value="选择" 
                                   actionListener="#{XunJianDianSheZhiController.vm.setCurrentEquipment(equipment)}" 
                                   process="@this" update="frmMain:rootContainer"
                                   oncomplete="PF('deviceSelectDialog').hide()"></p:commandLink>
                </p:column>
                <p:column >
                    <h:outputText value="#{equipment.parentStringChain}">

                    </h:outputText>
                </p:column>
                <p:column >
                    <h:outputText value="#{equipment.guiGeHeXingHao}">

                    </h:outputText>
                </p:column>
            </p:dataTable>
        </p:dialog>
        <p:dialog widgetVar="pictureSelectDialog" 
                  modal="true"
                  onHide="PF('rootContainer').update();">
            <p:dataTable value="#{XunJianDianSheZhiController.vm.currentEquipment.graphicList}" style="width:512px;"
                         var="graphic" 
                         paginatorAlwaysVisible="false"
                         paginator="true" rows="10"
                         paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                         id="graphicSelectList" widgetVar="equipmentSelectList"
                         styleClass="bg-c-row-odd wd-f-700"
                         scrollable="true"
                         emptyMessage="无数据">
                <f:facet name="header">
                    <h:outputText value="选择图片"/>
                </f:facet>
                <p:columnGroup type="header">
                    <p:row>
                        <p:column styleClass="tct wd-p-30" headerText="图片预览"></p:column>
                        <p:column styleClass="tct wd-p-10" headerText="选择"></p:column>
                    </p:row>
                </p:columnGroup>
                <p:column >
                    <p:graphicImage value="#{graphic.previewFilePath}"></p:graphicImage>
                </p:column>
                <p:column>
                    <p:commandLink value="选择" 
                                   actionListener="#{XunJianDianSheZhiController.vm.setCurrentGraphic(graphic)}" 
                                   process="@this" update="frmMain:rootContainer"
                                   oncomplete="PF('pictureSelectDialog').hide()"></p:commandLink>
                </p:column>
            </p:dataTable>
        </p:dialog>
        <p:dialog widgetVar="coordConfirmDialog" id="coordConfirmDialog"
                  modal="true" 
                  onHide="PF('rootContainer').update();">
            <p:inputText value="#{XunJianDianSheZhiController.vm.x}" class="x"></p:inputText>
            <p:inputText value="#{XunJianDianSheZhiController.vm.y}" class="y"></p:inputText>
            <p:commandButton value="确定" process="@this, coordConfirmDialog" 
                             actionListener="#{XunJianDianSheZhiController.onCoordConfirmDialogAccepted}"
                             update="frmMain:rootContainer" 
                             oncomplete="PF('coordConfirmDialog').hide()"></p:commandButton>
            <p:commandButton value="取消" 
                             process="@this" 
                             update="frmMain:rootContainer" 
                             oncomplete="PF('coordConfirmDialog').hide()"></p:commandButton>
        </p:dialog>
    </p:outputPanel>
</ui:composition>